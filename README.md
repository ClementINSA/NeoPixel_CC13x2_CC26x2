# NeoPixel_CC13x2_CC26x2
NeoPixel (WS2811) driver for TI SimpleLink devices CC26x2 and CC13x2.
The driver leverages the Sensor Controller of the MCU.

## How to use the driver?

### Required Hardware
The driver can be used without changes for the following
evaluation boards:
* LAUNCHXL-CC26X2R1 (https://www.ti.com/tool/LAUNCHXL-CC26X2R1)
* LAUNCHXL-CC1352P (https://www.ti.com/tool/LAUNCHXL-CC1352P)
* LAUNCHXL-CC1352R1 (https://www.ti.com/tool/LAUNCHXL-CC1352R1)
* LAUNCHXL-CC1312R1 (https://www.ti.com/tool/LAUNCHXL-CC1312R1)
* LP-CC2652RB (https://www.ti.com/tool/LP-CC2652RB)
* LP-CC2652R7 (https://www.ti.com/tool/LP-CC2652R7)
* LP-CC1352P7 (https://www.ti.com/tool/LP-CC1352P7)

### Required Software
* SimpleLink CC13xx and CC26xx software development kit (SDK) -
  https://www.ti.com/tool/download/SIMPLELINK-CC13XX-CC26XX-SDK
* Code Composer Studio integrated development environment (IDE) -
  https://www.ti.com/tool/download/CCSTUDIO (desktop version)
  or https://dev.ti.com/ide (cloud version)

### Project Setup
Assuming the SDK, the IDE and all their dependences are installed.
1. Open CCS.
2. Select an example-project in the SDK and import it in the CCS workspace
   (Project > Import CCS Projects...).
3. In the CCS project create the folder "NeoPixel". Copy all the content of
   the "source" folder of this repository into the folder newly created.
   Make sure to also include the folder called "SC".
4. Configure the toolchain to consider the newly created folder when building
   by adding it to the search path of the compiler (right click on the 
   project > Properties > Build > Arm Compiler > Include Options, then add
   the entry ``${PROJECT_LOC}/NeoPixel``.
   
### Code examples
Refer to the code examples available in the "example" folder.

## How to modify the driver? 

### Required Software
* Sensor Controller Studio (http://www.ti.com/tool/SENSOR-CONTROLLER-STUDIO)

### Guidance

* Change the pin used to drive the NeoPixel data pin
  
  1. Open the file ``NeoPixelsDriver.scp`` with Sensor Controller Studio.
  2. Go to "NeoPixelDriver > I/O Mapping".
  3. Change the PIN used (default is DIO 10).
  4. Make sure to import the file regenerated by the tool in the CCS project.

* Reduce the number of NeoPixels in the strip

  1. This can be done directly in the CCS project.
  2. In ``NeoPixel > NeoPixel.h`` and ``NeoPixel > NeoPixelEffect.h`` (if used),
     change the value set for ``NUMBER_OF_LEDS``. 
  
  Note: Changing the value of ``NUMBER_OF_LEDS`` does not impact the length of
  the memory allocated. If the memory allocated is smaller than the value of 
  ``NUMBER_OF_LEDS`` unexpected behavior may occur. Refer to the next bullet
  to learn modifying the memory size allocated.

* Increase the maximum number of NeoPixels in the strip

  1. Open the file ``NeoPixelsDriver.scp`` with Sensor Controller Studio.
  2. Go to "NeoPixelDriver > NeoPixelsTask > Constants and Data Structures".
  3. Change the value of the value ``TABLE_STATE_LENGTH`` (Note: the number of
     NeoPixels in the strip is ``TABLE_STATE_LENGTH / 2``)
  4. In order to limit the need for rebuild

## Technical details

### Meet the SimpleLinkâ„¢ Sensor Controller
(Source: https://www.ti.com/lit/swat014)
On TI CC13x2 and CC26x2 Wireless MCUs, the Sensor Controller is an Ultra-low power, 16-bit CPU
core that runs independently of the rest of the system (Arm Cortex-M4F and RF core). It is 
programmable and executes code from a dedicated 4kB RAM section (called AUXRAM).

### Implementation
Using bit-banging, a pin is toggled in order to meet the timing requirements of
the WS2811 (see http://www.world-semi.com/technology/details-129-3.html).
As the driver runs on a core independent from the application core and RF core, the execution timing
of the driver is not affected by their operations (e.g. Bluetooth LE connection). Similarly,
the execution of the driver does not impact the execution of the RF stacks or any other
software running on the application and RF cores.

### API
The API offered by this driver is similar to the one offered by Adafruit's NeoPixel driver
(https://github.com/adafruit/Adafruit_NeoPixel).

### Limits
* The driver is configured for RGB NeoPixels. It has been provisioned for other types
   of leds but has not been used in such conditions.
* The maximum number of NeoPixels in the strip is limited by the available AUXRAM.
  Each NeoPixel color is stored using 4 bytes. The default configuration allows to
  use 75 NeoPixels. Default configuration consumes 58.1% of the 4 kB AUXRAM available. 

## Author
Clement Chaduc works for Texas Instruments as applications engineer.
He is an expert of the 2.4 GHz-based RF communication technologies (especially Bluetooth Low Energy).
Always up for a challenge and passioned of embedded systems, Clement shares his knowledge through
conferences, publications, the TI E2E design support forums and contributions to open source projects.

## Disclaimer
The content of this repository has been developed on the authors' personal time.
This content is NOT provided by Texas Instruments (TI).
